<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Warp - Layered Live Media Transport</title>
<meta content="Luke Curley" name="author">
<meta content="Kirill Pugin" name="author">
<meta content="Suhas Nandakumar" name="author">
<meta content="
       This document defines the core behavior for Warp, a layered live media transport protocol.
Media is split into layers based on the underlying media encoding.
Each layer is transmitted independently over a QUIC stream.
QUIC streams are prioritized, allowing less important layers to be starved or dropped during congestion. 
    " name="description">
<meta content="xml2rfc 3.9.1" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-lcurley-warp-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.9.1
    Python 3.9.13
    appdirs 1.4.4
    ConfigArgParse 1.5.1
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.6.3
    pycountry 20.7.3
    pyflakes 2.3.1
    PyYAML 5.4.1
    requests 2.26.0
    setuptools 63.4.3
    six 1.15.0
-->
<link href="draft-lcurley-warp.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: avoid-page;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">WARP</td>
<td class="right">October 2022</td>
</tr></thead>
<tfoot><tr>
<td class="left">Curley, et al.</td>
<td class="center">Expires 23 April 2023</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Independent Submission</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-lcurley-warp-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2022-10-20" class="published">20 October 2022</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2023-04-23">23 April 2023</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">L. Curley</div>
<div class="org">Twitch</div>
</div>
<div class="author">
      <div class="author-name">K. Pugin</div>
<div class="org">Meta</div>
</div>
<div class="author">
      <div class="author-name">S. Nandakumar</div>
<div class="org">Cisco</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Warp - Layered Live Media Transport</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document defines the core behavior for Warp, a layered live media transport protocol.
Media is split into layers based on the underlying media encoding.
Each layer is transmitted independently over a QUIC stream.
QUIC streams are prioritized, allowing less important layers to be starved or dropped during congestion.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 23 April 2023.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2022 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="ulEmpty ulBare compact toc">
<li class="ulEmpty ulBare compact toc" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
<ul class="ulEmpty compact toc ulBare">
<li class="ulEmpty compact toc ulBare" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-terms-and-definitions" class="xref">Terms and Definitions</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty ulBare compact toc" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-motivation" class="xref">Motivation</a></p>
<ul class="ulEmpty compact toc ulBare">
<li class="ulEmpty compact toc ulBare" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1" class="keepWithNext"><a href="#section-2.1" class="xref">2.1</a>.  <a href="#name-latency" class="xref">Latency</a></p>
</li>
              <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="xref">2.2</a>.  <a href="#name-universal" class="xref">Universal</a></p>
</li>
              <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="xref">2.3</a>.  <a href="#name-intermediaries" class="xref">Intermediaries</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty ulBare compact toc" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-layers" class="xref">Layers</a></p>
<ul class="ulEmpty compact toc ulBare">
<li class="ulEmpty compact toc ulBare" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-media" class="xref">Media</a></p>
</li>
              <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-properties" class="xref">Properties</a></p>
</li>
              <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="xref">3.3</a>.  <a href="#name-decoder" class="xref">Decoder</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty ulBare compact toc" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-quic" class="xref">QUIC</a></p>
<ul class="ulEmpty compact toc ulBare">
<li class="ulEmpty compact toc ulBare" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-establishment" class="xref">Establishment</a></p>
</li>
              <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-streams" class="xref">Streams</a></p>
</li>
              <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-prioritization" class="xref">Prioritization</a></p>
</li>
              <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="xref">4.4</a>.  <a href="#name-cancellation" class="xref">Cancellation</a></p>
</li>
              <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="xref">4.5</a>.  <a href="#name-congestion-control" class="xref">Congestion Control</a></p>
</li>
              <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.4.2.6">
                <p id="section-toc.1-1.4.2.6.1"><a href="#section-4.6" class="xref">4.6</a>.  <a href="#name-termination" class="xref">Termination</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty ulBare compact toc" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-messages" class="xref">Messages</a></p>
<ul class="ulEmpty compact toc ulBare">
<li class="ulEmpty compact toc ulBare" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-headers" class="xref">HEADERS</a></p>
</li>
              <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-layer" class="xref">LAYER</a></p>
</li>
              <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="xref">5.3</a>.  <a href="#name-app" class="xref">APP</a></p>
</li>
              <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="xref">5.4</a>.  <a href="#name-goaway" class="xref">GOAWAY</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty ulBare compact toc" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a></p>
<ul class="ulEmpty compact toc ulBare">
<li class="ulEmpty compact toc ulBare" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-resource-exhaustion" class="xref">Resource Exhaustion</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty ulBare compact toc" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
</li>
          <li class="ulEmpty ulBare compact toc" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-appendix-a-layer-examples" class="xref">Appendix A. Layer Examples</a></p>
<ul class="ulEmpty compact toc ulBare">
<li class="ulEmpty compact toc ulBare" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="xref">8.1</a>.  <a href="#name-recommended" class="xref">Recommended</a></p>
</li>
              <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="xref">8.2</a>.  <a href="#name-tracks" class="xref">Tracks</a></p>
</li>
              <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="xref">8.3</a>.  <a href="#name-video" class="xref">Video</a></p>
<ul class="ulEmpty compact toc ulBare">
<li class="ulEmpty compact toc ulBare" id="section-toc.1-1.8.2.3.2.1">
                    <p id="section-toc.1-1.8.2.3.2.1.1"><a href="#section-8.3.1" class="xref">8.3.1</a>.  <a href="#name-encoding" class="xref">Encoding</a></p>
</li>
                  <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.8.2.3.2.2">
                    <p id="section-toc.1-1.8.2.3.2.2.1"><a href="#section-8.3.2" class="xref">8.3.2</a>.  <a href="#name-decode-order" class="xref">Decode Order</a></p>
</li>
                  <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.8.2.3.2.3">
                    <p id="section-toc.1-1.8.2.3.2.3.1"><a href="#section-8.3.3" class="xref">8.3.3</a>.  <a href="#name-group-of-pictures" class="xref">Group of Pictures</a></p>
</li>
                  <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.8.2.3.2.4">
                    <p id="section-toc.1-1.8.2.3.2.4.1"><a href="#section-8.3.4" class="xref">8.3.4</a>.  <a href="#name-scalable-video-coding" class="xref">Scalable Video Coding</a></p>
</li>
                  <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.8.2.3.2.5">
                    <p id="section-toc.1-1.8.2.3.2.5.1"><a href="#section-8.3.5" class="xref">8.3.5</a>.  <a href="#name-frames" class="xref">Frames</a></p>
</li>
                  <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.8.2.3.2.6">
                    <p id="section-toc.1-1.8.2.3.2.6.1"><a href="#section-8.3.6" class="xref">8.3.6</a>.  <a href="#name-slices" class="xref">Slices</a></p>
</li>
                  <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.8.2.3.2.7">
                    <p id="section-toc.1-1.8.2.3.2.7.1"><a href="#section-8.3.7" class="xref">8.3.7</a>.  <a href="#name-init" class="xref">Init</a></p>
</li>
                </ul>
</li>
              <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.8.2.4">
                <p id="section-toc.1-1.8.2.4.1"><a href="#section-8.4" class="xref">8.4</a>.  <a href="#name-audio" class="xref">Audio</a></p>
<ul class="ulEmpty compact toc ulBare">
<li class="ulEmpty compact toc ulBare" id="section-toc.1-1.8.2.4.2.1">
                    <p id="section-toc.1-1.8.2.4.2.1.1"><a href="#section-8.4.1" class="xref">8.4.1</a>.  <a href="#name-encoding-2" class="xref">Encoding</a></p>
</li>
                  <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.8.2.4.2.2">
                    <p id="section-toc.1-1.8.2.4.2.2.1"><a href="#section-8.4.2" class="xref">8.4.2</a>.  <a href="#name-simple" class="xref">Simple</a></p>
</li>
                  <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.8.2.4.2.3">
                    <p id="section-toc.1-1.8.2.4.2.3.1"><a href="#section-8.4.3" class="xref">8.4.3</a>.  <a href="#name-periodic-refresh" class="xref">Periodic Refresh</a></p>
</li>
                  <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.8.2.4.2.4">
                    <p id="section-toc.1-1.8.2.4.2.4.1"><a href="#section-8.4.4" class="xref">8.4.4</a>.  <a href="#name-segments" class="xref">Segments</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="ulEmpty ulBare compact toc" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-references" class="xref">References</a></p>
<ul class="ulEmpty compact toc ulBare">
<li class="ulEmpty compact toc ulBare" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="xref">9.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
</li>
              <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="xref">9.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty ulBare compact toc" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#appendix-A" class="xref"></a><a href="#name-contributors" class="xref">Contributors</a></p>
</li>
          <li class="ulEmpty ulBare compact toc" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-B" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">Warp is a live media transport protocol that utilizes the QUIC network protocol <span>[<a href="#QUIC" class="xref">QUIC</a>]</span>.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2"><a href="#motivation" class="xref">Section 2</a> covers the background and rationale behind Warp.
<a href="#layers" class="xref">Section 3</a> covers how media is encoded and split into layers.
<a href="#quic" class="xref">Section 4</a> covers how QUIC is used to transfer media.
<a href="#messages" class="xref">Section 5</a> covers how messages are encoded on the wire.<a href="#section-1-2" class="pilcrow">¶</a></p>
<div id="terms-and-definitions">
<section id="section-1.1">
        <h3 id="name-terms-and-definitions">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-terms-and-definitions" class="section-name selfRef">Terms and Definitions</a>
        </h3>
<p id="section-1.1-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED",
"MAY", and "OPTIONAL" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">Commonly used terms in this document are described below.<a href="#section-1.1-2" class="pilcrow">¶</a></p>
<p id="section-1.1-3">TODO definitions<a href="#section-1.1-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="motivation">
<section id="section-2">
      <h2 id="name-motivation">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-motivation" class="section-name selfRef">Motivation</a>
      </h2>
<div id="latency">
<section id="section-2.1">
        <h3 id="name-latency">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-latency" class="section-name selfRef">Latency</a>
        </h3>
<p id="section-2.1-1">In a perfect world, we could deliver live media at the same rate it is produced.
The end-to-end latency of a broadcast would be fixed and only subject to encoding and transmission delays.
Unfortunately, networks have variable throughput, primarily due to congestion.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1-2">Attempting to deliver media larger than this variable network bitrate causes queuing.
This queuing can occur anywhere in the path between the encoder and decoder.
For example: the application, the OS socket, a wifi router, within an ISP, or generally anywhere in transit.<a href="#section-2.1-2" class="pilcrow">¶</a></p>
<p id="section-2.1-3">If nothing is done, new frames will be appended to the end of a growing queue and will take longer to arrive than their predecessors, increasing latency.
Our job is to minimize the growth of this queue, and failing that, skip the queue when possible.<a href="#section-2.1-3" class="pilcrow">¶</a></p>
<p id="section-2.1-4">Thus speed at which a media protocol can detect and respond to queuing determines the latency.
We can generally classify existing media protocols into two categories based on the underlying network protocol:<a href="#section-2.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.1-5.1">TCP-based media protocols (ex. RTMP, HLS, DASH) are popular due to their simplicity.
Media is served/consumed in decode order while any networking is handled by the TCP layer.
However, these protocols primarily see use at higher latency targets due to their relatively slow detection and response to queuing.<a href="#section-2.1-5.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.1-5.2">UDP-based media protocols (ex. RTP, WebRTC, SRT) can side-step the issues with TCP and provide lower latency with better queue management.
However the media protocol is now responsible for fragmentation, congestion control, retransmissions, receiver feedback, reassembly, and more.
This added complexity significantly raises the implementation difficulty and hurts interoperability.<a href="#section-2.1-5.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-2.1-6">A goal of this draft is to get the best of both worlds: a simple protocol that can still rapidly detect and respond to congestion.
This is possible emergence of QUIC, designed to fix the shortcomings of TCP.
This draft relies on QUIC streams to deliver media layers in priority order during congestion.<a href="#section-2.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="universal">
<section id="section-2.2">
        <h3 id="name-universal">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-universal" class="section-name selfRef">Universal</a>
        </h3>
<p id="section-2.2-1">The media protocol ecosystem is fragmented; each protocol has it's own niche.
Specialization is often a good thing, but we believe there's enough overlap to warrant consolidation.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2-2">For example, a service might simultaneously ingest via WebRTC, SRT, RTMP, and/or a custom UDP protocol depending on the broadcaster.
The same service might then simultaneously distribute via WebRTC, LL-HLS, HLS, (or the DASH variants) and/or a custom UDP protocol depending on the viewer.<a href="#section-2.2-2" class="pilcrow">¶</a></p>
<p id="section-2.2-3">These media protocols are radically different and not interoperable; requiring transcoding or transmuxing.
This cost is further increased by the need to maintain separate stacks with different expertise requirements.<a href="#section-2.2-3" class="pilcrow">¶</a></p>
<p id="section-2.2-4">A goal of this draft is to cover a large spectrum of use-cases. Specifically:<a href="#section-2.2-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2-5.1">Consolidated contribution and distribution.
The primary difference between the two is the ability to fanout.
How does a CDN know how to forward media to N consumers and how does it reduce the encoded bitrate during congestion?
A single protocol can cover both use-cases provided intermediaries are informed on how to forward and drop media.<a href="#section-2.2-5.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.2-5.2">A configurable latency versus quality trade-off.
The producer (broadcaster) chooses how to encode and transmit media based on the desired user experience.
Each consumer (viewer) chooses how long to wait for media based on their desired user experience and network.
We want an experience that can vary from real-time and lossy for one viewer, to delayed and loss-less for another viewer, without separate encodings or protocols.<a href="#section-2.2-5.2" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="intermediaries">
<section id="section-2.3">
        <h3 id="name-intermediaries">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-intermediaries" class="section-name selfRef">Intermediaries</a>
        </h3>
<p id="section-2.3-1">The prevailing belief is that UDP-based protocols are more expensive and don't "scale".
While it's true that UDP is more difficult to optimize than TCP, QUIC itself is proof that it is is possible to reach performance parity.
In fact even some TCP-based protocols (ex. RTMP) don't "scale" either and are exclusively used for contribution as a result.<a href="#section-2.3-1" class="pilcrow">¶</a></p>
<p id="section-2.3-2">The truth is that the ability to scale a media protocol depends on intermediary support: proxies, caches, CDNs, SFUs, etc.
The success of HTTP-based media protocols is due to the ability to leverage traditional HTTP CDNs.<a href="#section-2.3-2" class="pilcrow">¶</a></p>
<p id="section-2.3-3">Meanwhile, it's difficult to build a CDN for media protocols that were not designed with intermediaries in mind.
For example, an intermediary has to parse the underlying codec to determine which RTP packets should be dropped first, and the decision is not deterministic or consistent for each hop.<a href="#section-2.3-3" class="pilcrow">¶</a></p>
<p id="section-2.3-4">A goal of this draft is to treat intermediaries as first class citizens.
Any identification, reliability, ordering, prioritization, caching, etc is written to the wire in header designed for intermediaries.
This ensures that intermediaries can easily route/fanout media to the final destination.
This also ensures that congestion response is consistent at every hop based on the preferences of the media producer.<a href="#section-2.3-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="layers">
<section id="section-3">
      <h2 id="name-layers">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-layers" class="section-name selfRef">Layers</a>
      </h2>
<p id="section-3-1">Warp is based on the concept of layered coding.
A layer is a combination of a media bitstream and a set of properties.<a href="#section-3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-2.1">The encoder determines how to split the encoded bitstream into layers (<a href="#media" class="xref">Section 3.1</a>).<a href="#section-3-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-3-2.2">Each layer is transferred over a QUIC stream, which are delivered independently according to the layer properties (<a href="#properties" class="xref">Section 3.2</a>).<a href="#section-3-2.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-3-2.3">The decoder receives each layer and skips any layers that do not arrive in time (<a href="#decoder" class="xref">Section 3.3</a>).<a href="#section-3-2.3" class="pilcrow">¶</a>
</li>
      </ul>
<div id="media">
<section id="section-3.1">
        <h3 id="name-media">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-media" class="section-name selfRef">Media</a>
        </h3>
<p id="section-3.1-1">An encoder produces one or more codec bitstreams for each track.
The bitstream is then fed to the decoder on the other end, after being transported over the network, in the same order its produced.
The problem, as explained in motivation (<a href="#latency" class="xref">Section 2.1</a>), is that networks cannot sustain a continuous rate and thus queuing occurs.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">Warp works by splitting the codec bitstream into layers that can be transmitted independently.
The producer determines how to split the bistream into layers: based on the track, GoP, frame/sample, or even slice.
Depending on how the layers are produced, the consumer has the ability to decode layers out of order and skip over gaps.
See the appendix for examples based on media encoding (<a href="#appendix.examples" class="xref">Section 8</a>).<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<p id="section-3.1-3">TOOD specify CMAF<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<p id="section-3.1-4">A layer MUST contain a single track.
A layer MAY contain any number of samples which MUST be in decode order (increasing DTS).
There MAY be gaps between samples, as specified by the presentation timestamp and duration within the container.<a href="#section-3.1-4" class="pilcrow">¶</a></p>
<p id="section-3.1-5">The goal of layers is to produce a hierarchy.
Layers MAY depend on any number of other layers and MAY overlap with other layers.<a href="#section-3.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="properties">
<section id="section-3.2">
        <h3 id="name-properties">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-properties" class="section-name selfRef">Properties</a>
        </h3>
<p id="section-3.2-1">Each layer has properties to go along with its contents.
These are written on the wire and inform how they layer should be transmitted at each hop.
This is primarily for the purpose of supporting intermediaries, but some of this information may also be used by the decoder.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">All currently defined properties are optional.<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-3.1">
            <code>id</code>.
A numeric identifier for the layer.
If non-zero, this value MUST be unique.
The default value is 0.<a href="#section-3.2-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-3.2">
            <code>order</code>.
A numeric priority such that the smaller values take priority.
A sender SHOULD transmit layers with smallest value first, effectively starving layers with larger values during congestion.
If two layers use the same value, they SHOULD be round-robined.
Note that layers can still arrive out of the intended order due to packet loss.
The default value is 0.<a href="#section-3.2-3.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-3.3">
            <code>depends</code>.
A list of numeric layer IDs.
This informs the decoder that it MUST receive and process the dependency layers first.
The decoder MAY support stream processing, such that it does not need to fully receive the dependency layers first.
The layer SHOULD have a larger <code>order</code> than its dependencies, if present.
The default value is 0, which means no dependency.<a href="#section-3.2-3.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-3.4">
            <code>cache</code>.
TODO Indicates the layer should be cached for some amount of time since last access. What about fragments with an unbounded age? Should we send an <code>expire</code> message instead?<a href="#section-3.2-3.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-3.5">
            <code>expires</code>.
TODO Indicates the layer should be dropped after some amount of time (ex. <code>RESET_STREAM</code>). Do we need clock sync for this? How does this interact with <code>cache</code>?<a href="#section-3.2-3.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-3.6">
            <code>timestamp</code>.
TODO The presentation timestamp of the earliest (not always first) frame in the layer. What does an intermediary need this for?<a href="#section-3.2-3.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-3.7">
            <code>track</code>
TODO The track identifier to be used in conjunction with the TRACK message.<a href="#section-3.2-3.7" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.2-4">See the appendix for some example layers and properties. <a href="#appendix.examples" class="xref">Section 8</a><a href="#section-3.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="decoder">
<section id="section-3.3">
        <h3 id="name-decoder">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-decoder" class="section-name selfRef">Decoder</a>
        </h3>
<p id="section-3.3-1">The consumer will receive multiple layers over the network in parallel.
The decoder MUST synchronize layers using presentation timestamps within the bitstream.
The decoder might not support decoding each layer independently, so the consumer MAY need to reorder prior to passing a bitstream to the decoder.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<p id="section-3.3-2">Layers are NOT REQUIRED to be aligned within or between tracks.
For example, a low quality rendition may have more frequent I-frames, and thus layers, than a higher quality rendition.
A decoder MUST be prepared to skip over any gaps between layers.<a href="#section-3.3-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="quic">
<section id="section-4">
      <h2 id="name-quic">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-quic" class="section-name selfRef">QUIC</a>
      </h2>
<div id="establishment">
<section id="section-4.1">
        <h3 id="name-establishment">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-establishment" class="section-name selfRef">Establishment</a>
        </h3>
<p id="section-4.1-1">A connection is established using WebTransport <span>[<a href="#WebTransport" class="xref">WebTransport</a>]</span>.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">To summarize:
The client issues a HTTP CONNECT request with the intention of establishing a new WebTransport session.
The server returns an 200 OK response if the WebTransport session has been established, or an error status otherwise.<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<p id="section-4.1-3">A WebTransport session exposes the basic QUIC service abstractions.
Specifically, either endpoint may create independent streams which are reliably delivered in order until canceled.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1-4">WebTransport can currently operate via HTTP/3 and HTTP/2, using QUIC or TCP under the hood respectively.
As mentioned in the motivation (<a href="#motivation" class="xref">Section 2</a>) section, TCP introduces head-of-line blocking and will result in a worse experience.
It is RECOMMENDED to use WebTransport over HTTP/3.<a href="#section-4.1-4" class="pilcrow">¶</a></p>
<p id="section-4.1-5">The application SHOULD use the CONNECT request for authentication and negotiation.
For example, including a authentication token and some identifier in the path.
The application MAY use QUIC streams for more complicated behavior.<a href="#section-4.1-5" class="pilcrow">¶</a></p>
<p id="section-4.1-6">TODO define auth inside the protocol?<a href="#section-4.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="streams">
<section id="section-4.2">
        <h3 id="name-streams">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-streams" class="section-name selfRef">Streams</a>
        </h3>
<p id="section-4.2-1">Warp endpoints communicate over unidirectional QUIC streams.
The application MAY use bidirectional QUIC streams for other purposes.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">A stream consists of sequential messages.
See messages (<a href="#messages" class="xref">Section 5</a>) for the list of messages and their encoding.
These are similar to QUIC and HTTP/3 frames, but called messages to avoid the media terminology.<a href="#section-4.2-2" class="pilcrow">¶</a></p>
<p id="section-4.2-3">Each stream MUST start with a <code>HEADERS</code> message. TODO better name.
This message includes information on how intermediaries should proxy or cache the stream.
If a stream is used to transmit a layer, the header MUST match the layer properties (<a href="#properties" class="xref">Section 3.2</a>).<a href="#section-4.2-3" class="pilcrow">¶</a></p>
<p id="section-4.2-4">Messages SHOULD be sent over the same stream if ordering is desired.
For example, <code>PAUSE</code> and <code>PLAY</code> messages SHOULD be sent on the same stream to avoid a race.<a href="#section-4.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="prioritization">
<section id="section-4.3">
        <h3 id="name-prioritization">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-prioritization" class="section-name selfRef">Prioritization</a>
        </h3>
<p id="section-4.3-1">Warp utilizes stream prioritization to deliver the most important content during congestion.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">The media producer SHOULD assign a numeric order to each stream, as contained in the HEADERS message (<a href="#headers" class="xref">Section 5.1</a>).
This is a strict prioritization scheme, such that any available bandwidth is allocated to streams in ascending order.
The order is determined at encode, written to the wire so it can be read by intermediaries, and will not be updated.
This effectively creates a priority queue that can be maintained over multiple hops.<a href="#section-4.3-2" class="pilcrow">¶</a></p>
<p id="section-4.3-3">QUIC supports stream prioritization but does not standardize any mechanisms; see Section 2.3 in <span>[<a href="#QUIC" class="xref">QUIC</a>]</span>.
QUIC libraries will need to expose a API to the application to set the priority of each stream.<a href="#section-4.3-3" class="pilcrow">¶</a></p>
<p id="section-4.3-4">Senders SHOULD support prioritized streams, although it is OPTIONAL on a path with no expected congestion.
Senders SHOULD use strict ordering, although relative weights MAY be acceptable if there are no other options.
Senders MUST obey the order as written to the wire.
Senders MAY choose to delay retransmitting lower priority streams when possible within QUIC flow control limits.<a href="#section-4.3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="cancellation">
<section id="section-4.4">
        <h3 id="name-cancellation">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-cancellation" class="section-name selfRef">Cancellation</a>
        </h3>
<p id="section-4.4-1">QUIC streams can be canceled by either endpoint with an error code.<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<p id="section-4.4-2">When using <code>order</code>, lower priority streams will be starved during congestion, perhaps indefinitely.
These streams will consume resources and flow control until they are canceled.
When nearing resource limits, an endpoint SHOULD cancel the lowest priority stream with error code 0.<a href="#section-4.4-2" class="pilcrow">¶</a></p>
<p id="section-4.4-3">When using <code>expires</code>, a stream SHOULD be canceled after the duration has elapsed.
This is not a full replacement for prioritization, but can provide some congestion response by clearing parts of the queue.<a href="#section-4.4-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="congestion-control">
<section id="section-4.5">
        <h3 id="name-congestion-control">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-congestion-control" class="section-name selfRef">Congestion Control</a>
        </h3>
<p id="section-4.5-1">As covered in the motivation section (<a href="#motivation" class="xref">Section 2</a>), the ability to prioritize or cancel streams is a form of congestion response.
It's equally important to detect congestion via congestion control, which is handled in the QUIC layer.<a href="#section-4.5-1" class="pilcrow">¶</a></p>
<p id="section-4.5-2">Bufferbloat is caused by routers queueing packets for an indefinite amount of time rather than drop them.
This latency significantly reduces the ability for the application to prioritize or drop media in response to congestion.
Senders SHOULD use a congestion control algorithm that reduces this bufferbloat.
It is NOT RECOMMENDED to use a loss-based algorithm (ex. Reno, CUBIC) unless the network fully supports ECN.<a href="#section-4.5-2" class="pilcrow">¶</a></p>
<p id="section-4.5-3">Live media is application-limited, which means that the encoder determines the max bitrate rather than the network.
Most TCP congestion control algorithms will only increase the congestion window if it is full, limiting the upwards mobility when application-limited.
Senders SHOULD use a congestion control algorithm that is designed for application-limited flows (ex. GCC).
Senders MAY periodically pad the connection with QUIC PING frames to fill the congestion window.<a href="#section-4.5-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="termination">
<section id="section-4.6">
        <h3 id="name-termination">
<a href="#section-4.6" class="section-number selfRef">4.6. </a><a href="#name-termination" class="section-name selfRef">Termination</a>
        </h3>
<p id="section-4.6-1">The QUIC connection can be terminated at any point with an error code.<a href="#section-4.6-1" class="pilcrow">¶</a></p>
<p id="section-4.6-2">The media producer MAY terminate the QUIC connection with an error code of 0 to indicate the clean termination of the broadcast.
The application SHOULD use a non-zero error code to indicate a fatal error.<a href="#section-4.6-2" class="pilcrow">¶</a></p>
<table class="center" id="table-1">
          <caption><a href="#table-1" class="selfRef">Table 1</a></caption>
<thead>
            <tr>
              <th class="text-right" rowspan="1" colspan="1">Code</th>
              <th class="text-left" rowspan="1" colspan="1">Reason</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-right" rowspan="1" colspan="1">0x0</td>
              <td class="text-left" rowspan="1" colspan="1">Broadcast Terminated</td>
            </tr>
            <tr>
              <td class="text-right" rowspan="1" colspan="1">0x1</td>
              <td class="text-left" rowspan="1" colspan="1">GOAWAY <a href="#goaway" class="xref">Section 5.4</a>
</td>
            </tr>
          </tbody>
        </table>
<p id="section-4.6-4">TODO define more error codes<a href="#section-4.6-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="messages">
<section id="section-5">
      <h2 id="name-messages">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-messages" class="section-name selfRef">Messages</a>
      </h2>
<p id="section-5-1">Messages consist of a type identifier followed by contents, depending on the message type.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">TODO document varint identifier
TODO more message types<a href="#section-5-2" class="pilcrow">¶</a></p>
<table class="center" id="table-2">
        <caption><a href="#table-2" class="selfRef">Table 2</a></caption>
<thead>
          <tr>
            <th class="text-right" rowspan="1" colspan="1">ID</th>
            <th class="text-left" rowspan="1" colspan="1">Messages</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-right" rowspan="1" colspan="1">0x0</td>
            <td class="text-left" rowspan="1" colspan="1">HEADERS <a href="#headers" class="xref">Section 5.1</a>
</td>
          </tr>
          <tr>
            <td class="text-right" rowspan="1" colspan="1">0x1</td>
            <td class="text-left" rowspan="1" colspan="1">LAYER <a href="#layer" class="xref">Section 5.2</a>
</td>
          </tr>
          <tr>
            <td class="text-right" rowspan="1" colspan="1">0x2</td>
            <td class="text-left" rowspan="1" colspan="1">APP <a href="#app" class="xref">Section 5.3</a>
</td>
          </tr>
          <tr>
            <td class="text-right" rowspan="1" colspan="1">0x10</td>
            <td class="text-left" rowspan="1" colspan="1">GOAWAY <a href="#goaway" class="xref">Section 5.4</a>
</td>
          </tr>
        </tbody>
      </table>
<div id="headers">
<section id="section-5.1">
        <h3 id="name-headers">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-headers" class="section-name selfRef">HEADERS</a>
        </h3>
<p id="section-5.1-1">The <code>HEADERS</code> message contains the information listed in layer properties (<a href="#properties" class="xref">Section 3.2</a>).<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">TODO better name
TODO document wire format
TODO use QPACK?<a href="#section-5.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="layer">
<section id="section-5.2">
        <h3 id="name-layer">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-layer" class="section-name selfRef">LAYER</a>
        </h3>
<p id="section-5.2-1">A <code>LAYER</code> message consists of the layer bitstream.
A <code>LAYER</code> message must be proceeded with a <code>HEADERS</code> message specifying the layer properties (<a href="#properties" class="xref">Section 3.2</a>).<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">TODO document CMAF
TODO document wire format
TODO support multiple container formats<a href="#section-5.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="app">
<section id="section-5.3">
        <h3 id="name-app">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-app" class="section-name selfRef">APP</a>
        </h3>
<p id="section-5.3-1">The <code>APP</code> message contains arbitrary contents.
A stream containing <code>APP</code> message SHOULD be cached and forwarded by intermediaries like any other stream; based on the <code>HEADERS</code> message (<a href="#headers" class="xref">Section 5.1</a>).<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<p id="section-5.3-2">TODO document wire format<a href="#section-5.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="goaway">
<section id="section-5.4">
        <h3 id="name-goaway">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-goaway" class="section-name selfRef">GOAWAY</a>
        </h3>
<p id="section-5.4-1">The <code>GOAWAY</code> message is sent by the server to force the client to reconnect.
This is useful for server maintenance or reassignments without severing the QUIC connection.
A server MAY use QUIC load balancing instead of a GOAWAY message.<a href="#section-5.4-1" class="pilcrow">¶</a></p>
<p id="section-5.4-2">The server initiates the graceful shutdown by sending a GOAWAY message.
The server MUST close the QUIC connection after a timeout with the GOAWAY error code (<a href="#termination" class="xref">Section 4.6</a>).
The server MAY close the QUIC connection with a different error code if there is a fatal error before shutdown.
The server SHOULD wait until the <code>GOAWAY</code> message and any pending streams have been fully acknowledged, plus an extra delay to ensure they have been processed.<a href="#section-5.4-2" class="pilcrow">¶</a></p>
<p id="section-5.4-3">A client that receives a <code>GOAWAY</code> message should establish a new WebTransport session to the provided URL.
This session SHOULD be made in parallel and MUST use a different QUIC connection (not pooled).
The optimal client will be connected for two servers for a short period, potentially receiving layers from both in parallel.<a href="#section-5.4-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-6">
      <h2 id="name-security-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-6-1">TODO expand<a href="#section-6-1" class="pilcrow">¶</a></p>
<div id="resource-exhaustion">
<section id="section-6.1">
        <h3 id="name-resource-exhaustion">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-resource-exhaustion" class="section-name selfRef">Resource Exhaustion</a>
        </h3>
<p id="section-6.1-1">Live media requires significant bandwidth and resources.
Failure to set limits will quickly cause resource exhaustion.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2">Warp uses QUIC flow control to impose resource limits at the network layer.
Endpoints SHOULD set flow control limits based on the anticipated media bitrate.<a href="#section-6.1-2" class="pilcrow">¶</a></p>
<p id="section-6.1-3">The media producer prioritizes and transmits streams out of order.
Streams might be starved indefinitely during congestion and SHOULD be canceled after hitting some timeout or resource limit.<a href="#section-6.1-3" class="pilcrow">¶</a></p>
<p id="section-6.1-4">The media consumer might receive streams out of order.
If stream data is buffered, for example to decode segments in order, then the media consumer SHOULD cancel a stream after hitting some timeout or resource limit.<a href="#section-6.1-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-7">
      <h2 id="name-iana-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-7-1">TODO<a href="#section-7-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="appendix.examples">
<section id="section-8">
      <h2 id="name-appendix-a-layer-examples">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-appendix-a-layer-examples" class="section-name selfRef">Appendix A. Layer Examples</a>
      </h2>
<p id="section-8-1">Warp offers a large degree of flexability on how layers are fragmented and prioritized.
There is no best solution; it depends on the desired complexity and user experience.<a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2">This section provides a summary of media encoding and some options available.<a href="#section-8-2" class="pilcrow">¶</a></p>
<div id="recommended">
<section id="section-8.1">
        <h3 id="name-recommended">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-recommended" class="section-name selfRef">Recommended</a>
        </h3>
<p id="section-8.1-1">Before explaining all of the options, there is a recommended approach:<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.1-2.1">a video layer per GoP (<a href="#appendix.gop" class="xref">Section 8.3.3</a>)<a href="#section-8.1-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.1-2.2">an audio layer at roughly the same timestamp (<a href="#appendix.segments" class="xref">Section 8.4.4</a>)<a href="#section-8.1-2.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-8.1-3">TODO section on prioritization
* audio should be delivered before video
* for new media should be delivered before old media, or the opposite if reliability is desired<a href="#section-8.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="tracks">
<section id="section-8.2">
        <h3 id="name-tracks">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-tracks" class="section-name selfRef">Tracks</a>
        </h3>
<p id="section-8.2-1">A broadcast consists of one or more tracks.
Each track has a type (audio, video, caption, etc) and uses a cooresponding codec.
There may be multiple tracks, including of the same type for a number of reasons.<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<p id="section-8.2-2">For example:<a href="#section-8.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.2-3.1">A track for each codec.<a href="#section-8.2-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.2-3.2">A track for each resolution and bitrate.<a href="#section-8.2-3.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.2-3.3">A track for each language.<a href="#section-8.2-3.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.2-3.4">A track for each camera feed.<a href="#section-8.2-3.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-8.2-4">Traditionally, these tracks could be muxed together into a single container or stream.
The goal of Warp is to independently deliver tracks, and even parts of a track, so they must be demuxed.<a href="#section-8.2-4" class="pilcrow">¶</a></p>
<p id="section-8.2-5">The simplest configuration is a single, continuous layer per track.
This allows tracks to be prioritized during congestion, although no media can be dropped.
The next section covers how to further split layers based on the type of media.<a href="#section-8.2-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="video">
<section id="section-8.3">
        <h3 id="name-video">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-video" class="section-name selfRef">Video</a>
        </h3>
<div id="encoding">
<section id="section-8.3.1">
          <h4 id="name-encoding">
<a href="#section-8.3.1" class="section-number selfRef">8.3.1. </a><a href="#name-encoding" class="section-name selfRef">Encoding</a>
          </h4>
<p id="section-8.3.1-1">Video is a sequence of frames with a display timestamp.
To improve compression, frames are encoded as deltas and can reference number of frames in the past (P-frames) and/or in the future (B-frames).
A frame with no dependencies (I-frame) is effectively an image file and is a seek point.<a href="#section-8.3.1-1" class="pilcrow">¶</a></p>
<p id="section-8.3.1-2">A common encoding structure is to only reference the previous frame, as it is simple and minimizes latency:<a href="#section-8.3.1-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-8.3.1-3">
<pre>
 I &lt;- P &lt;- P &lt;- P   I &lt;- P &lt;- P &lt;- P   I &lt;- P ...
</pre><a href="#section-8.3.1-3" class="pilcrow">¶</a>
</div>
<p id="section-8.3.1-4">Another common encoding structure is to use B-frames in a fixed pattern, which is easier for hardware encoding.
B-frames reference one or more future frames, which improves the compression ratio but increases latency.<a href="#section-8.3.1-4" class="pilcrow">¶</a></p>
<p id="section-8.3.1-5">This example is referenced in later sections:<a href="#section-8.3.1-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-8.3.1-6">
<pre>
    B     B         B     B         B
   / \   / \       / \   / \       / \
  /   \ /   \     /   \ /   \     /   \
 I &lt;-- P &lt;-- P   I &lt;-- P &lt;-- P   I &lt;-- P ...
</pre><a href="#section-8.3.1-6" class="pilcrow">¶</a>
</div>
<p id="section-8.3.1-7">Note that the B-frames reference I and P frames in this example, despite the lack of an arrow.
TODO better ASCII art<a href="#section-8.3.1-7" class="pilcrow">¶</a></p>
<p id="section-8.3.1-8">There is no such thing as an optimal encoding structure.
Encoders tuned for the best quality will produce a tangled spaghetti of references.
Encoders tuned for the lowest latency still have a lot of options for references.<a href="#section-8.3.1-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="decode-order">
<section id="section-8.3.2">
          <h4 id="name-decode-order">
<a href="#section-8.3.2" class="section-number selfRef">8.3.2. </a><a href="#name-decode-order" class="section-name selfRef">Decode Order</a>
          </h4>
<p id="section-8.3.2-1">The encoder outputs the bitstream in decode order, which means that each frame is output after its dependencies.
This is only relevant for B-frames as they must be buffered until the frame they reference has been flushed.<a href="#section-8.3.2-1" class="pilcrow">¶</a></p>
<p id="section-8.3.2-2">A layer MUST be in decode order.<a href="#section-8.3.2-2" class="pilcrow">¶</a></p>
<p id="section-8.3.2-3">For the example above, this would look like:<a href="#section-8.3.2-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-8.3.2-4">
<pre>
encode order: I B P B P I B P B P I B P ..
decode order: I P B P B I P B P B I P B ..
</pre><a href="#section-8.3.2-4" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="appendix.gop">
<section id="section-8.3.3">
          <h4 id="name-group-of-pictures">
<a href="#section-8.3.3" class="section-number selfRef">8.3.3. </a><a href="#name-group-of-pictures" class="section-name selfRef">Group of Pictures</a>
          </h4>
<p id="section-8.3.3-1">A group of pictures (GoP) is consists of an I-frame and the frames that directly or indirectly reference it.
Each GoP can be decoded independently and thus can be transmitted independently.
It is also safe to drop the tail of the GoP (in decode order) without causing decode errors.<a href="#section-8.3.3-1" class="pilcrow">¶</a></p>
<p id="section-8.3.3-2">A layer MAY consist of an entire GoP.
A layer MAY consist of multiple sequential GoPs.<a href="#section-8.3.3-2" class="pilcrow">¶</a></p>
<p id="section-8.3.3-3">Our example GoP structure would be split into three layers.<a href="#section-8.3.3-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-8.3.3-4">
<pre>
     layer 1         layer 2      layer 3
+---------------+---------------+---------
| I  P  B  P  B | I  P  B  P  B | I  P  B
+---------------+---------------+---------
</pre><a href="#section-8.3.3-4" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="scalable-video-coding">
<section id="section-8.3.4">
          <h4 id="name-scalable-video-coding">
<a href="#section-8.3.4" class="section-number selfRef">8.3.4. </a><a href="#name-scalable-video-coding" class="section-name selfRef">Scalable Video Coding</a>
          </h4>
<p id="section-8.3.4-1">The concept of layers is borrowed from scalable video coding (SVC).
When SVC is enabled, the encoder produces multiple bitstreams in a hierarchy.
Dropping the top layer degrades the user experience in a configured way, such as reducing the resolution, picture quality, and/or frame rate.<a href="#section-8.3.4-1" class="pilcrow">¶</a></p>
<p id="section-8.3.4-2">A layer MAY consist of an entire SVC layer.<a href="#section-8.3.4-2" class="pilcrow">¶</a></p>
<p id="section-8.3.4-3">Our example GoP structure would be split into six layers, assuming the B frames are part of a SVC layer:<a href="#section-8.3.4-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-8.3.4-4">
<pre>
    layer 2       layer 4     layer 6
+-------------+-------------+--------
|    B   B    |    B   B    |    B
+-------------+-------------+--------
|  I   P   P  |  I   P   P  |  I   P
+-------------+-------------+--------
    layer 1       layer 3     layer 5
</pre><a href="#section-8.3.4-4" class="pilcrow">¶</a>
</div>
<p id="section-8.3.4-5">Note that SVC encoding is more complicated than this; our example is a simple temporal encoding scheme.<a href="#section-8.3.4-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="frames">
<section id="section-8.3.5">
          <h4 id="name-frames">
<a href="#section-8.3.5" class="section-number selfRef">8.3.5. </a><a href="#name-frames" class="section-name selfRef">Frames</a>
          </h4>
<p id="section-8.3.5-1">With full knowledge of the encoding, the producer can split a GoP into multiple layers based on the frame.
However, this is highly dependent on the encoding, and the additional complexity might not improve the user experience.<a href="#section-8.3.5-1" class="pilcrow">¶</a></p>
<p id="section-8.3.5-2">A layer MAY consist of a single frame.<a href="#section-8.3.5-2" class="pilcrow">¶</a></p>
<p id="section-8.3.5-3">Our example GoP structure could be split into thirteen layers:<a href="#section-8.3.5-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-8.3.5-4">
<pre>
      2     4           7     9           12
+--------+--------+--------+--------+-----------+
|     B  |  B     |     B  |  B     |     B     |
|-----+--+--+-----+-----+--+--+-----+-----+-----+
|  I  |  P  |  P  |  I  |  P  |  P  |  I  |  P  |
+-----+-----+-----+-----+-----+-----+-----+-----+
   1     3     5     6     8     10    11    13
</pre><a href="#section-8.3.5-4" class="pilcrow">¶</a>
</div>
<p id="section-8.3.5-5">To reduce the number of layers, frames can be appended to a layer they depend on.
Layers are delivered in order so this is simpler and produces the same user experience.<a href="#section-8.3.5-5" class="pilcrow">¶</a></p>
<p id="section-8.3.5-6">A layer MAY consist of multiple frames within the same GoP.<a href="#section-8.3.5-6" class="pilcrow">¶</a></p>
<p id="section-8.3.5-7">The same GoP structure can be represented using eight layers:<a href="#section-8.3.5-7" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-8.3.5-8">
<pre>
      2     3           5     6           8
+--------+--------+-----------------+------------
|     B  |  B     |     B  |  B     |     B     |
+--------+--------+--------+--------+-----------+
|  I     P     P  |  I     P     P  |  I     P
+-----------------+-----------------+------------
         1                 4              7
</pre><a href="#section-8.3.5-8" class="pilcrow">¶</a>
</div>
<p id="section-8.3.5-9">We can further reduce the number of layers by combining some frames that don't depend on each other.
The only restriction is that frames can only reference frames earlier in the layer, or within a dependency layer.
For example, non-reference frames can have their own layer so they can be prioritized or dropped separate from reference frames.<a href="#section-8.3.5-9" class="pilcrow">¶</a></p>
<p id="section-8.3.5-10">The same GoP structure can also be represented using six layers, although we've removed our ability to drop individual B-frames:<a href="#section-8.3.5-10" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-8.3.5-11">
<pre>
    layer 2       layer 4     layer 6
+-------------+-------------+--------
|    B   B    |    B   B    |    B
+-------------+-------------+--------
|  I   P   P  |  I   P   P  |  I   P
+-------------+-------------+--------
    layer 1       layer 3     layer 5
</pre><a href="#section-8.3.5-11" class="pilcrow">¶</a>
</div>
<p id="section-8.3.5-12">Note that this is identical to our SVC example; we've effectively implemented our own temporal coding scheme.<a href="#section-8.3.5-12" class="pilcrow">¶</a></p>
</section>
</div>
<div id="slices">
<section id="section-8.3.6">
          <h4 id="name-slices">
<a href="#section-8.3.6" class="section-number selfRef">8.3.6. </a><a href="#name-slices" class="section-name selfRef">Slices</a>
          </h4>
<p id="section-8.3.6-1">Frames actually consist of multiple slices that reference other slices.
It's conceptually simpler to work with frames instead of slices, but splitting slices into layers may be useful.
For example, intra-refresh splits an I-frame into multiple I-slices (TODO terminology) and spread over multiple frames to smooth out the bitrate.
TODO are slices necessary?<a href="#section-8.3.6-1" class="pilcrow">¶</a></p>
<p id="section-8.3.6-2">A layer MAY consist of a single slice.
A layer MAY consist of multiple slices that are part of the same GoP.<a href="#section-8.3.6-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="init">
<section id="section-8.3.7">
          <h4 id="name-init">
<a href="#section-8.3.7" class="section-number selfRef">8.3.7. </a><a href="#name-init" class="section-name selfRef">Init</a>
          </h4>
<p id="section-8.3.7-1">For the most byte-conscious applications, initialization data can be sent over its own layer.
Multiple layers can depend on this initialization layer to avoid redundant transmissions.
For example: this is the init segment in CMAF (<code>moov</code> with no samples), which contains the SPS/PPS NALUs for h.264.<a href="#section-8.3.7-1" class="pilcrow">¶</a></p>
<p id="section-8.3.7-2">A layer MAY consist of no samples.<a href="#section-8.3.7-2" class="pilcrow">¶</a></p>
<p id="section-8.3.7-3">Our example layer per GoP would have an extra layer added:<a href="#section-8.3.7-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-8.3.7-4">
<pre>
     layer 2         layer 3      layer 4
+---------------+---------------+---------
| I  P  B  P  B | I  P  B  P  B | I  P  B
+---------------+---------------+---------
|                     init
+-----------------------------------------
                     layer 1
</pre><a href="#section-8.3.7-4" class="pilcrow">¶</a>
</div>
<p id="section-8.3.7-5">An initialization layer MUST be cached in memory until it expires.
TODO How do we do this?<a href="#section-8.3.7-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="audio">
<section id="section-8.4">
        <h3 id="name-audio">
<a href="#section-8.4" class="section-number selfRef">8.4. </a><a href="#name-audio" class="section-name selfRef">Audio</a>
        </h3>
<div id="encoding-1">
<section id="section-8.4.1">
          <h4 id="name-encoding-2">
<a href="#section-8.4.1" class="section-number selfRef">8.4.1. </a><a href="#name-encoding-2" class="section-name selfRef">Encoding</a>
          </h4>
<p id="section-8.4.1-1">Audio is dramatically simpler than video as it is not typically not delta encoded.
Audio samples are grouped together (group of samples) at a configured rate, also called a "frame".<a href="#section-8.4.1-1" class="pilcrow">¶</a></p>
<p id="section-8.4.1-2">In the below diagrams, each audio frame is denoted with an S.
The encoder spits out a continuous stream of samples:<a href="#section-8.4.1-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-8.4.1-3">
<pre>
S S S S S S S S S S S S S
</pre><a href="#section-8.4.1-3" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="simple">
<section id="section-8.4.2">
          <h4 id="name-simple">
<a href="#section-8.4.2" class="section-number selfRef">8.4.2. </a><a href="#name-simple" class="section-name selfRef">Simple</a>
          </h4>
<p id="section-8.4.2-1">The simplest configuration is to use a single layer for each audio track.
This may seem inefficient given the ease of dropping audio samples.
However, the audio bitrate is low and gaps cause quite a poor user experience, when compared to video.<a href="#section-8.4.2-1" class="pilcrow">¶</a></p>
<p id="section-8.4.2-2">A layer SHOULD consist of multiple audio frames.<a href="#section-8.4.2-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-8.4.2-3">
<pre>
          layer 1
+---------------------------
| S S S S S S S S S S S S S
+---------------------------
</pre><a href="#section-8.4.2-3" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="periodic-refresh">
<section id="section-8.4.3">
          <h4 id="name-periodic-refresh">
<a href="#section-8.4.3" class="section-number selfRef">8.4.3. </a><a href="#name-periodic-refresh" class="section-name selfRef">Periodic Refresh</a>
          </h4>
<p id="section-8.4.3-1">An improvement is to periodically split audio samples into separate layers.
This gives the consumer the ability to skip ahead during severe congestion or temporary connectivity loss.<a href="#section-8.4.3-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-8.4.3-2">
<pre>
     layer 1         layer 2      layer 3
+---------------+---------------+---------
| S  S  S  S  S | S  S  S  S  S | S  S  S
+---------------+---------------+---------
</pre><a href="#section-8.4.3-2" class="pilcrow">¶</a>
</div>
<p id="section-8.4.3-3">This frequency of audio layers is configurable, at the cost of additional overhead.
It's NOT RECOMMENDED to create a layer for each audio frame because of this overhead.<a href="#section-8.4.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="appendix.segments">
<section id="section-8.4.4">
          <h4 id="name-segments">
<a href="#section-8.4.4" class="section-number selfRef">8.4.4. </a><a href="#name-segments" class="section-name selfRef">Segments</a>
          </h4>
<p id="section-8.4.4-1">Video can only recover from severe congestion with an I-frame, so there's not much point recovering audio at a separate interval.
It is RECOMMENDED to create a new audio layer at each video I-frame.<a href="#section-8.4.4-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-8.4.4-2">
<pre>
     layer 1         layer 3      layer 5
+---------------+---------------+---------
| S  S  S  S  S | S  S  S  S  S | S  S  S
+---------------+---------------+---------
| I  P  B  P  B | I  P  B  P  B | I  P  B
+---------------+---------------+---------
     layer 2         layer 4      layer 6
</pre><a href="#section-8.4.4-2" class="pilcrow">¶</a>
</div>
<p id="section-8.4.4-3">This is effectively how HLS/DASH segments work, with the exception that the most recent layers are still pending.<a href="#section-8.4.4-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<section id="section-9">
      <h2 id="name-references">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-9.1">
        <h3 id="name-normative-references">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="ISOBMFF">[ISOBMFF]</dt>
        <dd>
<span class="refTitle">"Information technology — Coding of audio-visual objects — Part 12: ISO Base Media File Format"</span>, <time datetime="2015-12" class="refDate">December 2015</time>. </dd>
<dd class="break"></dd>
<dt id="QUIC">[QUIC]</dt>
        <dd>
<span class="refAuthor">Iyengar, J., Ed.</span> and <span class="refAuthor">M. Thomson, Ed.</span>, <span class="refTitle">"QUIC: A UDP-Based Multiplexed and Secure Transport"</span>, <span class="seriesInfo">RFC 9000</span>, <span class="seriesInfo">DOI 10.17487/RFC9000</span>, <time datetime="2021-05" class="refDate">May 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9000">https://www.rfc-editor.org/info/rfc9000</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="QUIC-RECOVERY">[QUIC-RECOVERY]</dt>
        <dd>
<span class="refAuthor">Iyengar, J., Ed.</span> and <span class="refAuthor">I. Swett, Ed.</span>, <span class="refTitle">"QUIC Loss Detection and Congestion Control"</span>, <span class="seriesInfo">RFC 9002</span>, <span class="seriesInfo">DOI 10.17487/RFC9002</span>, <time datetime="2021-05" class="refDate">May 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9002">https://www.rfc-editor.org/info/rfc9002</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="WebTransport">[WebTransport]</dt>
      <dd>
<span class="refAuthor">Frindell, A.</span>, <span class="refAuthor">Kinnear, E.</span>, and <span class="refAuthor">V. Vasiliev</span>, <span class="refTitle">"WebTransport over HTTP/3"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-webtrans-http3-03</span>, <time datetime="2022-07-06" class="refDate">6 July 2022</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-webtrans-http3-03.txt">https://www.ietf.org/archive/id/draft-ietf-webtrans-http3-03.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-9.2">
        <h3 id="name-informative-references">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="BBR">[BBR]</dt>
        <dd>
<span class="refAuthor">Cardwell, N.</span>, <span class="refAuthor">Cheng, Y.</span>, <span class="refAuthor">Yeganeh, S. H.</span>, <span class="refAuthor">Swett, I.</span>, and <span class="refAuthor">V. Jacobson</span>, <span class="refTitle">"BBR Congestion Control"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-cardwell-iccrg-bbr-congestion-control-02</span>, <time datetime="2022-03-07" class="refDate">7 March 2022</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-cardwell-iccrg-bbr-congestion-control-02.txt">https://www.ietf.org/archive/id/draft-cardwell-iccrg-bbr-congestion-control-02.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="CMAF">[CMAF]</dt>
        <dd>
<span class="refTitle">"Information technology -- Multimedia application format (MPEG-A) -- Part 19: Common media application format (CMAF) for segmented media"</span>, <time datetime="2020-03" class="refDate">March 2020</time>. </dd>
<dd class="break"></dd>
<dt id="NewReno">[NewReno]</dt>
      <dd>
<span class="refAuthor">Henderson, T.</span>, <span class="refAuthor">Floyd, S.</span>, <span class="refAuthor">Gurtov, A.</span>, and <span class="refAuthor">Y. Nishida</span>, <span class="refTitle">"The NewReno Modification to TCP's Fast Recovery Algorithm"</span>, <span class="seriesInfo">RFC 6582</span>, <span class="seriesInfo">DOI 10.17487/RFC6582</span>, <time datetime="2012-04" class="refDate">April 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6582">https://www.rfc-editor.org/info/rfc6582</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="contributors">
<section id="appendix-A">
      <h2 id="name-contributors">
<a href="#name-contributors" class="section-name selfRef">Contributors</a>
      </h2>
<p id="appendix-A-1">TODO<a href="#appendix-A-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Luke Curley</span></div>
<div dir="auto" class="left"><span class="org">Twitch</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:kixelated@gmail.com" class="email">kixelated@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Kirill Pugin</span></div>
<div dir="auto" class="left"><span class="org">Meta</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:ikir@meta.com" class="email">ikir@meta.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Suhas Nandakumar</span></div>
<div dir="auto" class="left"><span class="org">Cisco</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:snandaku@cisco.com" class="email">snandaku@cisco.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
